
"$schema": "http://schema.management.azure.com/schemas/2014-04-01-preview/deploymentTemplate.json#",
"contentVersion": "1.0.0.0", 

"parameter" : {
	"StorageAccountName": {
		"type": "string"
	},
	"adminUsername": {
		"type": "string"
	},
	"machineSize" : {
		"type" : "string"
	},
	"adminPassword": {
		"type": "securestring"
	},
	"dnsNameForPublicIP": {
		"type": "string"
	},
	"ubuntuOSVersion": {
		"type": "string",
		"defaultValue": "16.04.0-LTS"
	},
	"machineName":	{
		"type": "string"
	},
	"osDiskName": {
		"type": "string"
	},
	"dataDiskName": {
		"type": "string"
	},
	"dnsName" : {
		"type": "string"
	},
},
"variables" : {
"imagepublisher" : "Canonical",
"imageoffer" : "UbuntuServer",
"publicIPAddressName" : "myPublicIP",
"publicIPAllocation" : "Dynamic",
"privateIPAllocation" : "Dynamic",
"vNetworkName" : "ourVNetwork",
"networkaddressPrefix" : "10.0.0.0/16",
"subnetaddressPrefix" : "10.0.0.0/24",
"networkNic" : "nic1",
"subnetName" : "oursubnet",
"StorageAccountType" : "Standard_LRS",
"vnetID": "[resourceId('Microsoft.Network/virtualNetworks',variables('ourVNetwork'))]", 
"subnetRef": "[concat(variables('vnetID'),'/subnets/',variables('subnetName'))]",
}

"resources" : [
{
	"type" : "Microsoft.Storage/storageAccounts",
	"name" : "[parameters ( 'StorageAccountName' ) ]",
	"apiVersion" : "2015-06-15",
	"location" : "[resourceGroup().location]",
	"properties" :
		{ "accountType" : "[variable( 'StorageAccountType' )]"
		 },
},
{
	"apiVersion" : "2016-03-30",
	"type" : "Microsoft.Network/publicIPAddresses",
	"name" : "[variables( 'publicIPAddressName' )]",
	"location" : "[resourceGroup().location]",
	"properties" : 
		{ "publicIPAllocationMethod" : "[variables( 'publicIPAllocation' )]",
		  "dnsSettings" : 
		  	{	"domainNamelabel" : "[parameters( 'dnsName' )]"
		   	 }
		}
},
{
	"apiVersion" : "2016-03-30",
	"type" : "Microsoft.Network/virtualNetworks",
	"name" : "[ variable( 'vNetworkName ' )]",
	"location" : "[resourceGroup().location]",
	"properties" : 
		{ "addressSpace" : 
			{ "addressPrefixes":"[parameters( 'networkaddressPrefix' )]"
			},"subnets": 
				[{ "name" : "[variables( 'subnetName' )]", 
				"properties" : 
					{ "addressPrefix" : "[variables( 'subnetaddressPrefix' )]" 
					} 
				}]
		}
},
{
	"apiVersion" : "2016-03-30",
	"type" : "Microsoft.Network/networkInterfaces",
	"name" : "[variable( 'networkNic' )]",
	"location" : "[resourceGroup().location]",
	"dependsOn" : ["[concat('Microsoft.Network/publicIPAddresses/', variable( 'publicIPAddressName' ))]"
		,"[concat('Microsoft.Network/virtualNetworks/', variable( 'vNetworkName' ))]"],
	"properties" : 
		{ "ipConfigurations" : [{"name" : "ipconfig1", 
			"properties" : 
				{ "privateIPAllocationMethod" : "[variable( 'privateIPAllocation ')]"
				  ,"publicIPAddress" : 
				  	{
				  	 	"id" : "[resourceId('Microsoft.Network/publicIPAddress'
				  		,variable( 'publicIPAddressName' ))]" 
					}
				}
		,"subnet" : {"Id" : "[variables ('subnetRef')]"  
		}
},
{
	"apiVersion" : "2016-03-30",
	"type" : "Microsoft.Compute/virtualMachines",
	"name" : "[parameters( 'machineName' )]",
	"location" : "[resourceGroup().location]",
	"dependsOn" :
		["[concat('Microsoft.Network/networkInterfaces/',variables( 'networkNic' ))]"
		,"[concat('Microsoft.Storage/storageAccounts/',parameters( 'StorageAccountName' ))]"
		]
	,"properties" :
		{	"hardwareProfile" : {"vmSize" : "[parameters('machineSize')]"},
			"osProfile" : {
				"computerName" : "[parameters( 'machineName' )]"
				,"adminUsername" : "[parameters( 'adminUsername' )]"
				,"adminPassword" : "[parameters( 'adminPassword' )]"
			},
			"storageProfile" :
			 	{"imageReference" :
			 		{ "publisher" : "[variables ( 'imagepublisher' )]",
			 		  "offer" : "[variables( 'imageoffer' )]",
			 		  "sku" :"[ parameters( 'ubuntuOSVersion' )]",
			 		  "version" : "latest",	
			 		}

			 }

		}




},